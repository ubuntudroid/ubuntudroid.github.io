---
layout: post
title: Using JSON requests in QML
date: '2014-03-30T13:51:00.001+02:00'
author: Sven Bendel
tags:
- QML
- QT
- Ubuntu
modified_time: '2014-03-30T13:51:33.298+02:00'
blogger_id: tag:blogger.com,1999:blog-932652460086490809.post-2862832261122862545
blogger_orig_url: http://ubuntudroid.blogspot.com/2014/03/using-json-requests-in-qml.html
---

<i>Together with a friend I'm currently taking part in the <a href="http://developer.ubuntu.com/showdown/" target="_blank">Ubuntu App Showdown</a>. We decided to implement a simple QML <a href="http://getpocket.com/" target="_blank">Pocket</a> client. However, the pocket API is JSON based while the Ubuntu SDK (which is based on QML/QT) just provides means to work with XML HTTP requests. Here is how to work with JSON requests in QML.</i><br /><i><br /></i>To leverage working with JSON requests in QML, <a href="https://github.com/kromain/qml-utils" target="_blank">kromain</a> implemented a simple ListModel based way to handle JSON requests and responses. It works great for GET requests, but doesn't support POST requests and also misses some other commonly used features like setting the content type header. Therefore we <a href="https://github.com/kromain/qml-utils/pull/4" target="_blank">extended</a> his implementation with POST support and some other neat features. As of now he didn't merge our pull request, but you can of course use the code directly off from the patch branch in my repository.<br /><br />I will walk you through how to set up basic JSON based request/response handling using the extended version of kromain's QML. There are two approaches. Which one you choose depends on how you want to use the response data.<br /><br /><h4>Using response data in a ListView</h4>If you want to use the response data in a QML ListView you need to provide the <a href="https://github.com/ubuntudroid/qml-utils/blob/patch-1/JSONListModel/JSONListModel.qml" target="_blank">JSONListModel</a> as a model for your list view like outlined in the following example which shows how to implement a simple GET request for the unread objects on a user's pocket list (I will not bother with how you can acquire the consumer key and the access token as this is depends heavily on which service you plan to use):<br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">import QtQuick 2.0<br />import "../json" // this folder contains JSONListModel.qml and jsonpath.js </span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">ListView {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; id: items</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; property string accessToken: "" </span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; model: ListModel {}</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp;&nbsp;</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; JSONListModel {&nbsp;</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp;&nbsp; id: pocketModel </span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp;&nbsp; source: "https://getpocket.com/v3/get?consumer_key=YOUR_CONSUMER_KEY&amp;access_token=" + accessToken</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp;&nbsp; query: "$.list.*" // simple XPATH query over the JSON result</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp;&nbsp; requestType: "GET" // this is optional as GET is default</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp;&nbsp; Component.onCompleted: {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; items.model = model; // assign JSON model to ListView model (this only happens once when the component is created)</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; }</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; delegate: Subtitled {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text: resolved_title</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subText: excerpt</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; } </span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; onAccessTokenChanged: {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; if (accessToken !== "") {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; refresh();</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; }</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp; function refresh() {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pocketModel.refresh();</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp; }</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">}</span><br /><span style="font-family: Georgia,&quot;Times New Roman&quot;,serif;"><br /></span> This code will trigger a request for the user's reading list as soon as the access token is set. As soon as the model has changed the ListView's content will adapt automatically.<br /><br /><h4>Using the response as-is</h4>If you want to handle the response yourself you simply omit adding the model to a ListView. In the following example we shorten a URL using the <a href="https://developers.google.com/url-shortener/" target="_blank">Google URL Shortener</a> JSON API and post the shortened URL to the clipboard. At first we create a <span style="font-family: &quot;Courier New&quot;, Courier, monospace;">ShortenRequest</span> component for better reusability.<br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">import QtQuick 2.0</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">import "../json"</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">JSONListModel {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp; property string longUrl: ""</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;&nbsp;&nbsp; source: "https://www.googleapis.com/urlshortener/v1/url"</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; contentType: "application/json"</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; requestType: "POST"</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; query: "$"</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; postData: "{\"longUrl\":\""&nbsp;+ longUrl&nbsp;+ "\"}" </span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp;</span><br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; onListModelUpdateChanged: {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; var shortUrl = model.get(0).id;</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; Clipboard.push(shortUrl);</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; }</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">}</span><br /><br />When we want to send the request we just have to call the following method which creates a new instance of our <span style="font-family: &quot;Courier New&quot;, Courier, monospace;">ShortenRequest</span>: <br /><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">function shorten(longUrl) {</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; var request = Qt.createComponent("path/to/ShortenRequest.qml").createObject(null, {"longUrl": longUrl};</span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">&nbsp; &nbsp; request.refresh(); </span><br /><span style="font-family: &quot;Courier New&quot;, Courier, monospace;">} </span>